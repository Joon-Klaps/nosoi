<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spread of a dengue-like virus in a discrete space • nosoi</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Spread of a dengue-like virus in a discrete space">
<meta property="og:description" content="nosoi">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">nosoi</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../articles/nosoi.html">
    <span class="fas fa-play-circle"></span>
     
    Getting started
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-book"></span>
     
    Simulation set up
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/none.html">Spread of a pathogen in a homogeneous population</a>
    </li>
    <li>
      <a href="../../articles/discrete.html">Spread of a pathogen in a discrete structured population</a>
    </li>
    <li>
      <a href="../../articles/continuous.html">Spread of a pathogen in a continuous space</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-file"></span>
     
    Visualise &amp; summarise
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/output.html">nosoi output</a>
    </li>
    <li>
      <a href="../../articles/examples/viz.html">Visualization</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-file"></span>
     
    Pathogen examples
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/examples/dengue.html">Spread of dengue virus in a discrete space</a>
    </li>
    <li>
      <a href="../../articles/examples/ebola.html">Spread of Ebola-like virus in a continuous space</a>
    </li>
    <li>
      <a href="../../articles/examples/vector-competence.html">Epidemiological impact of mosquito vector competence</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../reference/index.html">
    <span class="fas fa-file-code-o"></span>
     
    Reference
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/continuous.html">Spread of a pathogen in a continuous space</a>
    </li>
    <li>
      <a href="../../articles/discrete.html">Spread of a pathogen in a discrete structured population</a>
    </li>
    <li>
      <a href="../../articles/examples/dengue.html">Spread of a dengue-like virus in a discrete space</a>
    </li>
    <li>
      <a href="../../articles/examples/ebola.html">Spread of an Ebola-like virus in continuous space</a>
    </li>
    <li>
      <a href="../../articles/examples/vector-competence.html">Epidemiological impact of mosquito vector competence variation</a>
    </li>
    <li>
      <a href="../../articles/examples/viz.html">Visualization tips</a>
    </li>
    <li>
      <a href="../../articles/none.html">Spread of a pathogen in a homogeneous population</a>
    </li>
    <li>
      <a href="../../articles/output.html">Output and summarization</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
<li>
  <a href="https://github.com/slequime/nosoi">
    <span class="fas fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="dengue_files/header-attrs-2.7/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Spread of a dengue-like virus in a discrete space</h1>
                        <h4 class="author">Sebastian Lequime</h4>
            
            <h4 class="date">2021-08-17</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/slequime/nosoi/blob/master/vignettes/examples/dengue.Rmd"><code>vignettes/examples/dengue.Rmd</code></a></small>
      <div class="hidden name"><code>dengue.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>In this example, our objective is to simulate a dengue-like epidemic in South-East Asia. Dengue is a dual-host pathogen (arbovirus) that spreads between mosquitoes and humans, with very different within-host dynamics. We will also take into account the location’s influence on mosquito activity by using the local monthly average temperature: the higher the temperature, the more mosquito activity (i.e. the more mosquitoes will bite a human at each time step). Mosquitoes will not move between countries, but humans will; we will use air transportation data to approximate the transition probability matrix between the different countries.</p>
<p>Most of the host parameters used for the simulation will be taken from the following published article:</p>
<blockquote>
<p>A. Fontaine, S. Lequime, I. Moltini-Conclois, D. Jiolle, I. Leparc-Goffart, R. C. Reiner Jr. &amp; L. Lambrechts (2018) <em>Epidemiological significance of dengue virus genetic variation in mosquito infection dynamics</em>. <strong>PLoS Pathog.</strong> 14(7): e1007187. <a href="https://journals.plos.org/plospathogens/article?id=10.1371/journal.ppat.1007187">Link</a></p>
</blockquote>
</div>
<div id="study-site" class="section level1">
<h1 class="hasAnchor">
<a href="#study-site" class="anchor"></a>Study site</h1>
<p>Our study will focus on 5 south-east Asian countries: China (only the southern part of the country), Cambodia, Laos, Thailand and Vietnam.</p>
<div id="average-annual-temperature" class="section level2">
<h2 class="hasAnchor">
<a href="#average-annual-temperature" class="anchor"></a>Average annual temperature</h2>
<p>Here we use <a href="http://worldclim.org/version2">WorldClim v2</a> data (average temperature (°C) - tavg 10m). The rasters are loaded, cut to fit the study site, and the temperature value averaged for all countries (i.e. states in our simulation) each month. Country spatial polygons come from <a href="https://gadm.org/data.html">GADM</a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Initial data</span>
<span class="co">#3 letter code of countries of interest:</span>
<span class="va">SE.Asia</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"CHN"</span>,<span class="st">"KHM"</span>,<span class="st">"LAO"</span>,<span class="st">"THA"</span>,<span class="st">"VNM"</span><span class="op">)</span>
<span class="va">study.area.SE.Asia</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/extent.html">extent</a></span><span class="op">(</span><span class="fl">90</span>, <span class="fl">125</span>, <span class="fl">5</span>, <span class="fl">30</span><span class="op">)</span> <span class="co">#to crop the raster to the study site</span>

<span class="co">#Load spatial polygones:</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://rgdal.r-forge.r-project.org">rgdal</a></span><span class="op">)</span>; <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster">raster</a></span><span class="op">)</span>; <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-forge.r-project.org/projects/rgeos/">rgeos</a></span><span class="op">)</span>
<span class="va">GADM.admin0</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://rgdal.r-forge.r-project.org/reference/readOGR.html">readOGR</a></span><span class="op">(</span>dsn <span class="op">=</span> <span class="st">"/path/to/your/shapefiles/."</span>, layer <span class="op">=</span> <span class="st">"gadm36_0"</span><span class="op">)</span>

<span class="co">#This loops loads monthly rasters and cuts ("masks") each country. It then computes the average temperature of the country</span>
<span class="va">final.results</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>

<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span><span class="op">{</span>
   <span class="kw">if</span><span class="op">(</span><span class="va">i</span> <span class="op">&lt;</span> <span class="fl">10</span><span class="op">)</span> <span class="va">raster.file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"~/path/to/WClim/wc2.0_10m_tavg/wc2.0_10m_tavg_0"</span>, <span class="va">i</span>, <span class="st">".tif"</span>, sep<span class="op">=</span><span class="st">""</span><span class="op">)</span> <span class="co">#for proper file name</span>
   <span class="kw">if</span><span class="op">(</span><span class="va">i</span> <span class="op">&gt;=</span> <span class="fl">10</span><span class="op">)</span> <span class="va">raster.file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"~/path/to/WClim/wc2.0_10m_tavg/wc2.0_10m_tavg_"</span>, <span class="va">i</span>, <span class="st">".tif"</span>, sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="co">#for proper file name</span>
  
  <span class="va">temp.raster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/crop.html">crop</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html">raster</a></span><span class="op">(</span><span class="va">raster.file</span><span class="op">)</span>, <span class="va">study.area.SE.Asia</span><span class="op">)</span> <span class="co">#loads raster and cuts to study site</span>
  
  <span class="va">country.results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="op">)</span>
  
  <span class="kw">for</span><span class="op">(</span><span class="va">country</span> <span class="kw">in</span> <span class="va">SE.Asia</span><span class="op">)</span><span class="op">{</span>
    <span class="va">GADM.admin0.subset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/subset.html">subset</a></span><span class="op">(</span><span class="va">GADM.admin0</span>, <span class="va">GID_0</span> <span class="op">==</span> <span class="va">country</span><span class="op">)</span> 
    <span class="va">GADM.admin0.subset.simp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rgeos/man/topo-unary-gSimplify.html">gSimplify</a></span><span class="op">(</span><span class="va">GADM.admin0.subset</span>, <span class="fl">0.1</span><span class="op">)</span> <span class="co">#Simplifies the polygones</span>

    <span class="va">cut.raster</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/mask.html">mask</a></span><span class="op">(</span><span class="va">temp.raster</span>, <span class="va">GADM.admin0.subset.simp</span>, snap<span class="op">=</span><span class="st">"out"</span><span class="op">)</span>

    <span class="va">country.results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind.data.frame</a></span><span class="op">(</span><span class="va">country.results</span>,<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>country<span class="op">=</span><span class="va">country</span>, Temp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">cut.raster</span><span class="op">[</span><span class="op">]</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span>
  
  <span class="va">country.results</span><span class="op">$</span><span class="va">Month</span> <span class="op">&lt;-</span> <span class="va">i</span>
  
  <span class="va">final.results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind.data.frame</a></span><span class="op">(</span><span class="va">final.results</span>, <span class="va">country.results</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># write.csv(final.results, file="avgTemp_data.csv", row.names = FALSE)</span></code></pre></div>
<p>For convenience, you can find this data <a href="https://github.com/slequime/nosoi/blob/master/vignettes/examples/avgTemp_data.csv">here</a>. We can visualize these data on a map:</p>
<p><img src="dengue_files/figure-html/avgTemp2-1.png" width="700"></p>
<p>This is the pattern of average temperature for each country over the year:</p>
<p><img src="dengue_files/figure-html/avgTemp3-1.png" width="700"></p>
<p>Using these data, we will fit a trigonometric function to each of the locations to obtain a function that links day of the year to mean temperature. The function will be of the form <span class="math inline">\(T_{avg} = k_1 \times sin(\frac{2\pi}{365}t) + k_2 \times cos(\frac{2\pi}{365}t) + \beta\)</span> (Eq. 1). We fit this function on data from each location to get the values of <span class="math inline">\(k_1\)</span>, <span class="math inline">\(k_2\)</span> and <span class="math inline">\(\beta\)</span>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model.coef</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
<span class="kw">for</span><span class="op">(</span><span class="va">current.country</span> <span class="kw">in</span> <span class="va">SE.Asia</span><span class="op">)</span><span class="op">{</span>
  <span class="va">final.results.country</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/subset.html">subset</a></span><span class="op">(</span><span class="va">final.results</span>, <span class="va">country</span> <span class="op">==</span> <span class="va">current.country</span><span class="op">)</span>
  
  <span class="va">reslm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">final.results.country</span><span class="op">$</span><span class="va">Temp</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">/</span><span class="fl">365</span><span class="op">*</span><span class="va">final.results.country</span><span class="op">$</span><span class="va">Day</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">/</span><span class="fl">365</span><span class="op">*</span><span class="va">final.results.country</span><span class="op">$</span><span class="va">Day</span><span class="op">)</span><span class="op">)</span>
  
  <span class="va">model.coef</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind.data.frame</a></span><span class="op">(</span><span class="va">model.coef</span>,
                                 <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>country<span class="op">=</span><span class="va">current.country</span>, 
                                            Beta<span class="op">=</span><span class="va">reslm</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, 
                                            k1<span class="op">=</span><span class="va">reslm</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, 
                                            k2<span class="op">=</span><span class="va">reslm</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Using the data from <a href="https://link.springer.com/chapter/10.1007/978-3-319-06877-0_4">Rossi et al. (2014) Ecological Modelling Applied to Entomology</a>, we have a link between temperature and oviposition. Since mosquito feeding is directly linked to their oviposition, we will assume that feeding activity follows the same relationship with temperature, i.e. <span class="math inline">\(R_{activity} = \alpha_0 \times (1-e^{\alpha_1(T_{air}-T_{max})}) \times (T_{air}-T_{min})^{\alpha_2}\)</span> (Eq. 2). Temperature is modeled according to (Eq. 1) as a function of time, so we can combine both functions to obtain a direct link, for each location, between mosquito activity and time. This will be then rescaled to vary between 0 and 1:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#According to Rossi et al:</span>
<span class="co">#a0 = 0.0011</span>
<span class="co">#a1 = 0.0101</span>
<span class="co">#a1 = 3.445</span>
<span class="co">#Tmin = 10</span>
<span class="co">#Tmax = 40</span>

<span class="co"># Equation from Rossi et al.</span>
<span class="va">R.activity</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">temp</span><span class="op">)</span><span class="op">{</span><span class="fl">0.0011</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fl">0.0101</span><span class="op">*</span><span class="op">(</span><span class="va">temp</span><span class="op">-</span><span class="fl">40</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="va">temp</span><span class="op">-</span><span class="fl">10</span><span class="op">)</span><span class="op">*</span><span class="fl">3.445</span><span class="op">}</span>

<span class="co">#Equation linking Temperature and time:</span>
<span class="va">fun1</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">k1</span>, <span class="va">k2</span>, <span class="va">Beta</span><span class="op">)</span><span class="op">{</span><span class="va">k1</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">/</span><span class="fl">365</span><span class="op">*</span><span class="va">x</span><span class="op">)</span><span class="op">+</span><span class="va">k2</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">/</span><span class="fl">365</span><span class="op">*</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="va">Beta</span><span class="op">}</span>

<span class="co">#Combining both</span>
<span class="va">fun2</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">k1</span>, <span class="va">k2</span>, <span class="va">Beta</span><span class="op">)</span> <span class="fu">R.activity</span><span class="op">(</span><span class="fu">fun1</span><span class="op">(</span><span class="va">x</span>, <span class="va">k1</span>, <span class="va">k2</span>, <span class="va">Beta</span><span class="op">)</span><span class="op">)</span>

<span class="co">#Equation for each location:</span>
<span class="va">fun.CHN</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">fun2</span><span class="op">(</span><span class="va">x</span>, <span class="op">-</span><span class="fl">2.7250361</span>, <span class="fl">8.2347735</span>, <span class="fl">15.35648</span><span class="op">)</span>
<span class="va">fun.KHM</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">fun2</span><span class="op">(</span><span class="va">x</span>, <span class="fl">0.8137334</span>, <span class="op">-</span><span class="fl">1.4049071</span>, <span class="fl">26.79546</span><span class="op">)</span>
<span class="va">fun.LAO</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">fun2</span><span class="op">(</span><span class="va">x</span>, <span class="op">-</span><span class="fl">0.2478662</span>, <span class="op">-</span><span class="fl">3.7164672</span>, <span class="fl">23.09855</span><span class="op">)</span>
<span class="va">fun.THA</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">fun2</span><span class="op">(</span><span class="va">x</span>, <span class="fl">0.8709198</span>, <span class="op">-</span><span class="fl">2.064461</span>, <span class="fl">26.28191</span><span class="op">)</span>
<span class="va">fun.VNM</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">fun2</span><span class="op">(</span><span class="va">x</span>, <span class="op">-</span><span class="fl">0.6151016</span>, <span class="op">-</span><span class="fl">3.7640298</span>, <span class="fl">23.49819</span><span class="op">)</span>

<span class="co">#for rescaling</span>
<span class="co">#1) find maximum value:</span>
<span class="va">max.value</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
<span class="fu"><a href="https://rdrr.io/r/stats/optimize.html">optimize</a></span><span class="op">(</span><span class="va">fun.CHN</span>, interval<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">365</span><span class="op">)</span>, maximum<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">$</span><span class="va">objective</span>,
<span class="fu"><a href="https://rdrr.io/r/stats/optimize.html">optimize</a></span><span class="op">(</span><span class="va">fun.KHM</span>, interval<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">365</span><span class="op">)</span>, maximum<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">$</span><span class="va">objective</span>,
<span class="fu"><a href="https://rdrr.io/r/stats/optimize.html">optimize</a></span><span class="op">(</span><span class="va">fun.LAO</span>, interval<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">365</span><span class="op">)</span>, maximum<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">$</span><span class="va">objective</span>,
<span class="fu"><a href="https://rdrr.io/r/stats/optimize.html">optimize</a></span><span class="op">(</span><span class="va">fun.THA</span>, interval<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">365</span><span class="op">)</span>, maximum<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">$</span><span class="va">objective</span>,
<span class="fu"><a href="https://rdrr.io/r/stats/optimize.html">optimize</a></span><span class="op">(</span><span class="va">fun.VNM</span>, interval<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">365</span><span class="op">)</span>, maximum<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">$</span><span class="va">objective</span><span class="op">)</span><span class="op">)</span>
<span class="co">#max.value is 0.008001941</span>

<span class="co">#2) rephrase function "fun2":</span>
<span class="va">fun2</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">k1</span>, <span class="va">k2</span>, <span class="va">Beta</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">temp</span> <span class="op">=</span> <span class="fu">R.activity</span><span class="op">(</span><span class="fu">fun1</span><span class="op">(</span><span class="va">x</span>, <span class="va">k1</span>, <span class="va">k2</span>, <span class="va">Beta</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">0.008001941</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span><span class="op">}</span>

<span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">stat_function</span><span class="op">(</span>fun<span class="op">=</span><span class="va">fun.CHN</span>,<span class="fu">aes</span><span class="op">(</span>colour<span class="op">=</span><span class="st">"CHN"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">stat_function</span><span class="op">(</span>fun<span class="op">=</span><span class="va">fun.KHM</span>,<span class="fu">aes</span><span class="op">(</span>colour<span class="op">=</span><span class="st">"KHM"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">stat_function</span><span class="op">(</span>fun<span class="op">=</span><span class="va">fun.LAO</span>,<span class="fu">aes</span><span class="op">(</span>colour<span class="op">=</span><span class="st">"LAO"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">stat_function</span><span class="op">(</span>fun<span class="op">=</span><span class="va">fun.THA</span>,<span class="fu">aes</span><span class="op">(</span>colour<span class="op">=</span><span class="st">"THA"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">stat_function</span><span class="op">(</span>fun<span class="op">=</span><span class="va">fun.VNM</span>,<span class="fu">aes</span><span class="op">(</span>colour<span class="op">=</span><span class="st">"VNM"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html">xlim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">750</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">labs</span><span class="op">(</span>x<span class="op">=</span><span class="st">"Time (in days)"</span>, y<span class="op">=</span><span class="st">"Mosquito activity"</span><span class="op">)</span></code></pre></div>
<p><img src="dengue_files/figure-html/avgTemp5-1.png" width="700"></p>
<p>Since this mosquito activity index we have generated should only vary between 0 and 1, we can reformulate <code>fun2</code> as:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fun2</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">k1</span>, <span class="va">k2</span>, <span class="va">Beta</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">R.activity</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">temp</span><span class="op">)</span><span class="op">{</span><span class="fl">0.0011</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fl">0.0101</span><span class="op">*</span><span class="op">(</span><span class="va">temp</span><span class="op">-</span><span class="fl">40</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="va">temp</span><span class="op">-</span><span class="fl">10</span><span class="op">)</span><span class="op">*</span><span class="fl">3.445</span><span class="op">}</span>
  <span class="va">temp</span> <span class="op">=</span> <span class="fu">R.activity</span><span class="op">(</span><span class="fu">fun1</span><span class="op">(</span><span class="va">x</span>, <span class="va">k1</span>, <span class="va">k2</span>, <span class="va">Beta</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">0.008001941</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">temp</span> <span class="op">&lt;=</span> <span class="fl">0</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">temp</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span><span class="op">}</span></code></pre></div>
<p>Now we can plug everything together to have the full expression of our <code>n_contact</code> function for humans, depending on mosquito activity for each location, which itself depends on the mean temperature. For each individual host, the daily number of contacts is the rounded random draw from a normal distribution with <span class="math inline">\(mean = mosquito.activity \times 2\)</span> (2 being here chosen empirically) and <span class="math inline">\(sd = 1\)</span> (chosen empirically). <code>nContact</code> here thus depends on <code>prestime</code> (“absolute time” of the simulation), and <code>current.in</code>, i.e. the location of the hosts, thus both <code>timeDep.nContact</code> and <code>diff.nContact</code> should be <code>TRUE</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n_contact</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">prestime</span>, <span class="va">current.in</span><span class="op">)</span> <span class="op">{</span>
<span class="co">#functions</span>
<span class="va">R.activity</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">temp</span><span class="op">)</span><span class="op">{</span><span class="fl">0.0011</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fl">0.0101</span><span class="op">*</span><span class="op">(</span><span class="va">temp</span><span class="op">-</span><span class="fl">40</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="va">temp</span><span class="op">-</span><span class="fl">10</span><span class="op">)</span><span class="op">*</span><span class="fl">3.445</span><span class="op">}</span>
<span class="va">fun1</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">k1</span>, <span class="va">k2</span>, <span class="va">Beta</span><span class="op">)</span><span class="op">{</span><span class="va">k1</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">/</span><span class="fl">365</span><span class="op">*</span><span class="va">x</span><span class="op">)</span><span class="op">+</span><span class="va">k2</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">/</span><span class="fl">365</span><span class="op">*</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="va">Beta</span><span class="op">}</span>
<span class="va">fun2</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">k1</span>, <span class="va">k2</span>, <span class="va">Beta</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">R.activity</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">temp</span><span class="op">)</span><span class="op">{</span><span class="fl">0.0011</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fl">0.0101</span><span class="op">*</span><span class="op">(</span><span class="va">temp</span><span class="op">-</span><span class="fl">40</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="va">temp</span><span class="op">-</span><span class="fl">10</span><span class="op">)</span><span class="op">*</span><span class="fl">3.445</span><span class="op">}</span>
  <span class="va">temp</span> <span class="op">=</span> <span class="fu">R.activity</span><span class="op">(</span><span class="fu">fun1</span><span class="op">(</span><span class="va">x</span>, <span class="va">k1</span>, <span class="va">k2</span>, <span class="va">Beta</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">0.008001941</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">temp</span> <span class="op">&lt;=</span> <span class="fl">0</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">temp</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span><span class="op">}</span>

<span class="co">#temp results depending of location</span>
<span class="kw">if</span> <span class="op">(</span><span class="va">current.in</span> <span class="op">==</span> <span class="st">"CHN"</span><span class="op">)</span> <span class="op">{</span><span class="va">mosquito.activity</span> <span class="op">=</span> <span class="fu">fun2</span><span class="op">(</span><span class="va">prestime</span>, <span class="op">-</span><span class="fl">2.7250361</span>, <span class="fl">8.2347735</span>, <span class="fl">15.35648</span><span class="op">)</span><span class="op">}</span>
<span class="kw">if</span> <span class="op">(</span><span class="va">current.in</span> <span class="op">==</span> <span class="st">"KHM"</span><span class="op">)</span> <span class="op">{</span><span class="va">mosquito.activity</span> <span class="op">=</span> <span class="fu">fun2</span><span class="op">(</span><span class="va">prestime</span>, <span class="fl">0.8137334</span>, <span class="op">-</span><span class="fl">1.4049071</span>, <span class="fl">26.79546</span><span class="op">)</span><span class="op">}</span>
<span class="kw">if</span> <span class="op">(</span><span class="va">current.in</span> <span class="op">==</span> <span class="st">"LAO"</span><span class="op">)</span> <span class="op">{</span><span class="va">mosquito.activity</span> <span class="op">=</span> <span class="fu">fun2</span><span class="op">(</span><span class="va">prestime</span>, <span class="op">-</span><span class="fl">0.2478662</span>, <span class="op">-</span><span class="fl">3.7164672</span>, <span class="fl">23.09855</span><span class="op">)</span><span class="op">}</span>
<span class="kw">if</span> <span class="op">(</span><span class="va">current.in</span> <span class="op">==</span> <span class="st">"THA"</span><span class="op">)</span> <span class="op">{</span><span class="va">mosquito.activity</span> <span class="op">=</span> <span class="fu">fun2</span><span class="op">(</span><span class="va">prestime</span>, <span class="fl">0.8709198</span>, <span class="op">-</span><span class="fl">2.064461</span>, <span class="fl">26.28191</span><span class="op">)</span><span class="op">}</span>
<span class="kw">if</span> <span class="op">(</span><span class="va">current.in</span> <span class="op">==</span> <span class="st">"VNM"</span><span class="op">)</span> <span class="op">{</span><span class="va">mosquito.activity</span> <span class="op">=</span> <span class="fu">fun2</span><span class="op">(</span><span class="va">prestime</span>, <span class="op">-</span><span class="fl">0.6151016</span>, <span class="op">-</span><span class="fl">3.7640298</span>, <span class="fl">23.49819</span><span class="op">)</span><span class="op">}</span>

<span class="co">#final result</span>
<span class="va">temp.contact2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">mosquito.activity</span><span class="op">*</span><span class="fl">2</span>,sd<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="kw">if</span><span class="op">(</span><span class="va">temp.contact2</span> <span class="op">&gt;=</span> <span class="fl">0</span><span class="op">)</span> <span class="va">final.contact</span> <span class="op">=</span> <span class="va">temp.contact2</span>
<span class="kw">if</span> <span class="op">(</span><span class="va">temp.contact2</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span> <span class="va">final.contact</span> <span class="op">=</span> <span class="fl">0</span>

<span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">final.contact</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>This fitted function for each location will be used to compute the number of mosquitoes that bite an infected human at each time step (see below).</p>
</div>
<div id="air-transportation" class="section level2">
<h2 class="hasAnchor">
<a href="#air-transportation" class="anchor"></a>Air transportation</h2>
<p>We will also model the movement of humans between these different countries assuming they use air transportation. We use here data available at <a href="https://openflights.org/data.html">OpenFlights</a>. This website contains information about the airports and the routes linking two airports together. Since we have no information about the number of passengers on each route, we will assume that the more routes link two countries together, the more passengers travel between them.</p>
<p>First, we extract the airports of our study site:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">airports</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"~/Dropbox/C-Leuven Projects/Nosoi/Nosoi-Rpackage/Dengue Data/airports.dat"</span>, col_names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">airports</span><span class="op">)</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"AirportID"</span>,<span class="st">"Name"</span>, <span class="st">"City"</span>, <span class="st">"Country"</span>, <span class="st">"IATA"</span>, <span class="st">"ICAO"</span>, <span class="st">"Latitude"</span>, <span class="st">"Longitude"</span>, <span class="st">"Altitude"</span>, <span class="st">"Timezone"</span>,    <span class="st">"DST"</span>, <span class="st">"Tz"</span>, <span class="st">"Type"</span>, <span class="st">"Source"</span><span class="op">)</span>

<span class="va">SE.Asia</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"CHN"</span>,<span class="st">"KHM"</span>,<span class="st">"LAO"</span>,<span class="st">"THA"</span>,<span class="st">"VNM"</span><span class="op">)</span>

<span class="co"># AirportID: Unique OpenFlights identifier for this airport.</span>
<span class="co"># Name: Name of airport. May or may not contain the City name.</span>
<span class="co"># City: Main city served by airport. May be spelled differently from Name.</span>
<span class="co"># Country: Country or territory where airport is located. See countries.dat to cross-reference to ISO 3166-1 codes.</span>
<span class="co"># IATA: 3-letter IATA code. Null if not assigned/unknown.</span>
<span class="co"># ICAO: 4-letter ICAO code. Null if not assigned.</span>
<span class="co"># Latitude: Decimal degrees, usually to six significant digits. Negative is South, positive is North.</span>
<span class="co"># Longitude: Decimal degrees, usually to six significant digits. Negative is West, positive is East.</span>
<span class="co"># Altitude: In feet.</span>
<span class="co"># Timezone: Hours offset from UTC. Fractional hours are expressed as decimals, eg. India is 5.5.</span>
<span class="co"># DST:  Daylight savings time. One of E (Europe), A (US/Canada), S (South America), O (Australia), Z (New Zealand), N (None) or U (Unknown). See also: Help: Time</span>
<span class="co"># Tz database time zone:    Timezone in "tz" (Olson) format, eg. "America/Los_Angeles".</span>
<span class="co"># Type:     Type of the airport. Value "airport" for air terminals, "station" for train stations, "port" for ferry terminals and "unknown" if not known. In airports.csv, only type=airport is included.</span>

<span class="co">#This dataframe contains the 3-letter code for each country</span>
<span class="va">country_code</span> <span class="op">&lt;-</span> <span class="fu">read_delim</span><span class="op">(</span><span class="st">"country_code.csv"</span>, <span class="st">";"</span>, escape_double <span class="op">=</span> <span class="cn">FALSE</span>, trim_ws <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co">#Merging airports and country_code dataframe</span>
<span class="va">airports2</span> <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">airports</span>, <span class="va">country_code</span><span class="op">)</span>

<span class="co">#subsetting airports from the study site</span>
<span class="va">airports2.sub</span>  <span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/subset.html">subset</a></span><span class="op">(</span><span class="va">airports2</span>, <span class="va">Code3</span> <span class="op">%in%</span> <span class="va">SE.Asia</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">Latitude</span> <span class="op">&gt;=</span> <span class="fl">5</span> <span class="op">&amp;</span> <span class="va">Latitude</span> <span class="op">&lt;=</span> <span class="fl">30</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">Longitude</span> <span class="op">&gt;=</span> <span class="fl">90</span> <span class="op">&amp;</span> <span class="va">Longitude</span> <span class="op">&lt;=</span> <span class="fl">125</span><span class="op">)</span><span class="op">)</span>

<span class="co">#worldmap</span>
<span class="va">worldmap</span> <span class="op">&lt;-</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/borders.html">borders</a></span><span class="op">(</span><span class="st">"world"</span>, colour<span class="op">=</span><span class="st">"gray50"</span>, fill<span class="op">=</span><span class="st">"#efede1"</span><span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="va">worldmap</span> <span class="op">+</span> <span class="fu">coord_cartesian</span><span class="op">(</span>xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">90</span>, <span class="fl">125</span><span class="op">)</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">30</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_point</span><span class="op">(</span>data<span class="op">=</span><span class="va">airports2.sub</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">Longitude</span>, y<span class="op">=</span><span class="va">Latitude</span>, color<span class="op">=</span><span class="va">Country</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">scale_color_discrete</span><span class="op">(</span>guide<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">labs</span><span class="op">(</span>x<span class="op">=</span><span class="st">"longitude"</span>,y<span class="op">=</span><span class="st">"latitude"</span><span class="op">)</span></code></pre></div>
<p><img src="dengue_files/figure-html/air1-1.png" width="700"></p>
<p>Then we extract the routes that link these airports together:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>

<span class="va">routes</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"~/Dropbox/C-Leuven Projects/Nosoi/Nosoi-Rpackage/Dengue Data/routes.dat"</span>, col_names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">routes</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Airline"</span>, <span class="st">"AirlineID"</span>, <span class="st">"SourceAirport"</span>, <span class="st">"SourceAirportID"</span>, <span class="st">"DestinationAirport"</span>, 
                     <span class="st">"DestinationAirportID"</span>,<span class="st">"Codeshare"</span>, <span class="st">"Stops"</span>, <span class="st">"Equipment"</span><span class="op">)</span>
<span class="va">routes</span><span class="op">$</span><span class="va">SourceAirportID</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">routes</span><span class="op">$</span><span class="va">SourceAirportID</span><span class="op">)</span>
<span class="va">routes</span><span class="op">$</span><span class="va">DestinationAirportID</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">routes</span><span class="op">$</span><span class="va">DestinationAirportID</span><span class="op">)</span>
  
<span class="co"># Airline   2-letter (IATA) or 3-letter (ICAO) code of the airline.</span>
<span class="co"># Airline ID    Unique OpenFlights identifier for airline (see Airline).</span>
<span class="co"># Source airport    3-letter (IATA) or 4-letter (ICAO) code of the source airport.</span>
<span class="co"># Source airport ID     Unique OpenFlights identifier for source airport (see Airport)</span>
<span class="co"># Destination airport   3-letter (IATA) or 4-letter (ICAO) code of the destination airport.</span>
<span class="co"># Destination airport ID    Unique OpenFlights identifier for destination airport (see Airport)</span>
<span class="co"># Codeshare     "Y" if this flight is a codeshare (that is, not operated by Airline, but another carrier), empty otherwise.</span>
<span class="co"># Stops     Number of stops on this flight ("0" for direct)</span>
<span class="co"># Equipment     3-letter IATA codes for plane type(s) generally used on this flight, separated by spaces</span>

<span class="co">#get airport information from:</span>
<span class="va">routes</span> <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">routes</span>, <span class="va">airports2</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"SourceAirportID"</span><span class="op">=</span><span class="st">"AirportID"</span><span class="op">)</span><span class="op">)</span> <span class="co">#origin</span>
<span class="va">routes</span> <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">routes</span>, <span class="va">airports2</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"DestinationAirportID"</span><span class="op">=</span><span class="st">"AirportID"</span><span class="op">)</span>, suffix<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">".FR"</span>,<span class="st">".TO"</span><span class="op">)</span><span class="op">)</span> <span class="co">#destination</span>

<span class="va">routes.sub</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/subset.html">subset</a></span><span class="op">(</span><span class="va">routes</span>, <span class="va">ICAO.TO</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/unique.html">unique</a></span><span class="op">(</span><span class="va">airports2.sub</span><span class="op">$</span><span class="va">ICAO</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">ICAO.FR</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/unique.html">unique</a></span><span class="op">(</span><span class="va">airports2.sub</span><span class="op">$</span><span class="va">ICAO</span><span class="op">)</span><span class="op">)</span>

<span class="co">#differentiation of national &amp; international routes:</span>

<span class="va">routes.sub</span> <span class="op">=</span> <span class="va">routes.sub</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>type<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">Country.FR</span> <span class="op">==</span> <span class="va">Country.TO</span>, <span class="st">"National"</span>,<span class="st">"International"</span><span class="op">)</span><span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="va">worldmap</span> <span class="op">+</span> <span class="fu">coord_cartesian</span><span class="op">(</span>xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">90</span>, <span class="fl">125</span><span class="op">)</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">30</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_curve</span><span class="op">(</span>data<span class="op">=</span><span class="va">routes.sub</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Longitude.FR</span>, y <span class="op">=</span> <span class="va">Latitude.FR</span>, xend <span class="op">=</span> <span class="va">Longitude.TO</span>, yend <span class="op">=</span> <span class="va">Latitude.TO</span>, color<span class="op">=</span><span class="va">type</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fl">0.1</span>,curvature <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span> 
   <span class="fu">labs</span><span class="op">(</span>x<span class="op">=</span><span class="st">"longitude"</span>,y<span class="op">=</span><span class="st">"latitude"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_color_manual</span><span class="op">(</span>name<span class="op">=</span><span class="st">"Route type"</span>,values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"red"</span>,<span class="st">"gray70"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">theme</span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>, panel.ontop <span class="op">=</span> <span class="cn">FALSE</span>,
        panel.grid.major <span class="op">=</span> <span class="fu">element_line</span><span class="op">(</span>size<span class="op">=</span><span class="fl">0.25</span>, linetype<span class="op">=</span><span class="st">"dashed"</span>, colour <span class="op">=</span><span class="st">"grey70"</span><span class="op">)</span>,
        axis.ticks<span class="op">=</span><span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
        plot.caption<span class="op">=</span><span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> </code></pre></div>
<p><img src="dengue_files/figure-html/air2-1.png" width="700"></p>
<p>We will subset to keep only routes between two different countries, and create the connectivity matrix. The number of routes for each destination will then serve to compute destination probabilities for each origin country, thus creating the <code>transition.matrix</code> needed by <code>nosoi</code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Keeping international routes</span>
<span class="va">routes.sub</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/subset.html">subset</a></span><span class="op">(</span><span class="va">routes.sub</span>, <span class="va">type</span> <span class="op">==</span> <span class="st">"International"</span><span class="op">)</span>

<span class="co">#Create data.frame for futur matrix</span>
<span class="va">df</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>From<span class="op">=</span><span class="va">SE.Asia</span>, To<span class="op">=</span><span class="va">SE.Asia</span><span class="op">)</span>
<span class="va">df</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/subset.html">subset</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">From</span> <span class="op">!=</span> <span class="va">To</span><span class="op">)</span>
<span class="va">df</span><span class="op">$</span><span class="va">N</span> <span class="op">=</span> <span class="cn">NA</span>

<span class="co">#counting each route for each country combination</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">df</span><span class="op">[</span><span class="va">i</span>,<span class="st">"N"</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html">nrow</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/subset.html">subset</a></span><span class="op">(</span><span class="va">routes.sub</span>, <span class="va">Code3.FR</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.character.html">as.character</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span><span class="op">$</span><span class="va">From</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">Code3.TO</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.character.html">as.character</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span><span class="op">$</span><span class="va">To</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="co">#create matrix layout</span>
<span class="va">df.matrix</span> <span class="op">=</span> <span class="va">df</span> <span class="op">%&gt;%</span> <span class="fu">spread</span><span class="op">(</span><span class="va">To</span>, value<span class="op">=</span><span class="va">N</span>, fill<span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="va">df.matrix</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">df.matrix</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">df.matrix</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">df.matrix</span><span class="op">)</span>

<span class="co">#Get probabilities (beware, rows should sum up to 1)</span>
<span class="va">df_transpose</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/transpose.html">t</a></span><span class="op">(</span><span class="va">df.matrix</span><span class="op">)</span>
<span class="va">probabilities</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">df_transpose</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="va">i</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">)</span>
<span class="va">transition.matrix</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/transpose.html">t</a></span><span class="op">(</span><span class="va">probabilities</span><span class="op">)</span></code></pre></div>
<p>We can represent this transition matrix on a map:</p>
<p><img src="dengue_files/figure-html/air4-1.png" width="700"></p>
</div>
</div>
<div id="simulation-parameters" class="section level1">
<h1 class="hasAnchor">
<a href="#simulation-parameters" class="anchor"></a>Simulation parameters</h1>
<div id="host-a-humans" class="section level2">
<h2 class="hasAnchor">
<a href="#host-a-humans" class="anchor"></a>Host A: Humans</h2>
<div id="pexit" class="section level3">
<h3 class="hasAnchor">
<a href="#pexit" class="anchor"></a><code>pExit</code>
</h3>
<p>In Fontaine <em>et al.</em>, humans do not die from the dengue infection, but exit the simulation when their transmission probability approaches 0 on its way down (see below). To approximate this behavior, we will use one of the parameters used in <code>pTrans</code>, called <code>Md_human</code>, which is the time since infection at which <code>pTrans</code> equals 50% of its maximum value. We will assume here that after three times this period, an infected human cannot transmit the virus any more and will thus exit the simulation:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p_Exit_fct_human</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>,<span class="va">Md_human</span><span class="op">)</span><span class="op">{</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">t</span> <span class="op">&lt;</span> <span class="fl">3</span><span class="op">*</span><span class="va">Md_human</span><span class="op">)</span><span class="op">{</span><span class="va">p</span><span class="op">=</span><span class="fl">0</span><span class="op">}</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">t</span> <span class="op">&gt;=</span> <span class="fl">3</span><span class="op">*</span><span class="va">Md_human</span><span class="op">)</span><span class="op">{</span><span class="va">p</span><span class="op">=</span><span class="fl">1</span><span class="op">}</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div id="pmove" class="section level3">
<h3 class="hasAnchor">
<a href="#pmove" class="anchor"></a><code>pMove</code>
</h3>
<p>The daily probability to move <code>pMove</code> for a host is empirically set to 0.01 (1% chance for a host to move each day).</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p_Move_fct_human</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span><span class="op">{</span><span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fl">0.01</span><span class="op">)</span><span class="op">}</span></code></pre></div>
</div>
<div id="ncontact" class="section level3">
<h3 class="hasAnchor">
<a href="#ncontact" class="anchor"></a><code>nContact</code>
</h3>
<p>This parameter was detailed before and depends on the location and the “absolute” time of the simulation.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n_contact_human</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">prestime</span>, <span class="va">current.in</span><span class="op">)</span> <span class="op">{</span>
<span class="co">#functions</span>
<span class="va">R.activity</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">temp</span><span class="op">)</span><span class="op">{</span><span class="fl">0.0011</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fl">0.0101</span><span class="op">*</span><span class="op">(</span><span class="va">temp</span><span class="op">-</span><span class="fl">40</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="va">temp</span><span class="op">-</span><span class="fl">10</span><span class="op">)</span><span class="op">*</span><span class="fl">3.445</span><span class="op">}</span>
<span class="va">fun1</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">k1</span>, <span class="va">k2</span>, <span class="va">Beta</span><span class="op">)</span><span class="op">{</span><span class="va">k1</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">/</span><span class="fl">365</span><span class="op">*</span><span class="va">x</span><span class="op">)</span><span class="op">+</span><span class="va">k2</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">/</span><span class="fl">365</span><span class="op">*</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="va">Beta</span><span class="op">}</span>
<span class="va">fun2</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">k1</span>, <span class="va">k2</span>, <span class="va">Beta</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">R.activity</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">temp</span><span class="op">)</span><span class="op">{</span><span class="fl">0.0011</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fl">0.0101</span><span class="op">*</span><span class="op">(</span><span class="va">temp</span><span class="op">-</span><span class="fl">40</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="va">temp</span><span class="op">-</span><span class="fl">10</span><span class="op">)</span><span class="op">*</span><span class="fl">3.445</span><span class="op">}</span>
  <span class="va">temp</span> <span class="op">=</span> <span class="fu">R.activity</span><span class="op">(</span><span class="fu">fun1</span><span class="op">(</span><span class="va">x</span>, <span class="va">k1</span>, <span class="va">k2</span>, <span class="va">Beta</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">0.008001941</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">temp</span> <span class="op">&lt;=</span> <span class="fl">0</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">temp</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span><span class="op">}</span>

<span class="co">#temp results depending of location</span>
<span class="kw">if</span> <span class="op">(</span><span class="va">current.in</span> <span class="op">==</span> <span class="st">"CHN"</span><span class="op">)</span> <span class="op">{</span><span class="va">mosquito.activity</span> <span class="op">=</span> <span class="fu">fun2</span><span class="op">(</span><span class="va">prestime</span>, <span class="op">-</span><span class="fl">2.7250361</span>, <span class="fl">8.2347735</span>, <span class="fl">15.35648</span><span class="op">)</span><span class="op">}</span>
<span class="kw">if</span> <span class="op">(</span><span class="va">current.in</span> <span class="op">==</span> <span class="st">"KHM"</span><span class="op">)</span> <span class="op">{</span><span class="va">mosquito.activity</span> <span class="op">=</span> <span class="fu">fun2</span><span class="op">(</span><span class="va">prestime</span>, <span class="fl">0.8137334</span>, <span class="op">-</span><span class="fl">1.4049071</span>, <span class="fl">26.79546</span><span class="op">)</span><span class="op">}</span>
<span class="kw">if</span> <span class="op">(</span><span class="va">current.in</span> <span class="op">==</span> <span class="st">"LAO"</span><span class="op">)</span> <span class="op">{</span><span class="va">mosquito.activity</span> <span class="op">=</span> <span class="fu">fun2</span><span class="op">(</span><span class="va">prestime</span>, <span class="op">-</span><span class="fl">0.2478662</span>, <span class="op">-</span><span class="fl">3.7164672</span>, <span class="fl">23.09855</span><span class="op">)</span><span class="op">}</span>
<span class="kw">if</span> <span class="op">(</span><span class="va">current.in</span> <span class="op">==</span> <span class="st">"THA"</span><span class="op">)</span> <span class="op">{</span><span class="va">mosquito.activity</span> <span class="op">=</span> <span class="fu">fun2</span><span class="op">(</span><span class="va">prestime</span>, <span class="fl">0.8709198</span>, <span class="op">-</span><span class="fl">2.064461</span>, <span class="fl">26.28191</span><span class="op">)</span><span class="op">}</span>
<span class="kw">if</span> <span class="op">(</span><span class="va">current.in</span> <span class="op">==</span> <span class="st">"VNM"</span><span class="op">)</span> <span class="op">{</span><span class="va">mosquito.activity</span> <span class="op">=</span> <span class="fu">fun2</span><span class="op">(</span><span class="va">prestime</span>, <span class="op">-</span><span class="fl">0.6151016</span>, <span class="op">-</span><span class="fl">3.7640298</span>, <span class="fl">23.49819</span><span class="op">)</span><span class="op">}</span>

<span class="co">#final result</span>
<span class="va">temp.contact2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">mosquito.activity</span><span class="op">*</span><span class="fl">2</span>,sd<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="kw">if</span><span class="op">(</span><span class="va">temp.contact2</span> <span class="op">&gt;=</span> <span class="fl">0</span><span class="op">)</span> <span class="va">final.contact</span> <span class="op">=</span> <span class="va">temp.contact2</span>
<span class="kw">if</span> <span class="op">(</span><span class="va">temp.contact2</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span> <span class="va">final.contact</span> <span class="op">=</span> <span class="fl">0</span>

<span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">final.contact</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div id="ptrans" class="section level3">
<h3 class="hasAnchor">
<a href="#ptrans" class="anchor"></a><code>pTrans</code>
</h3>
<p>Fontaine <em>et al.</em> model the transmission probability of a human to a mosquito using a 5-parameter equation based on two logistic functions, allowing the value of <code>pTrans</code> to go up in time, reach a plateau and then decrease over time:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p_Trans_fct_human</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">K_human</span>, <span class="va">Mg_human</span>, <span class="va">Bg_human</span>, <span class="va">Md_human</span>, <span class="va">Bd_human</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">K_human</span><span class="op">*</span><span class="fl">1</span><span class="op">/</span><span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Hyperbolic.html">tanh</a></span><span class="op">(</span><span class="op">(</span><span class="va">t</span><span class="op">-</span><span class="va">Mg_human</span><span class="op">)</span><span class="op">/</span><span class="va">Bg_human</span><span class="op">)</span><span class="op">)</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Hyperbolic.html">tanh</a></span><span class="op">(</span><span class="op">(</span><span class="va">t</span><span class="op">-</span><span class="va">Md_human</span><span class="op">)</span><span class="op">/</span><span class="va">Bd_human</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Each parameter, except <code>t</code> (time since infection), corresponds to individually set parameters, mimicking heterogeneity among hosts:</p>
<ul>
<li>
<span class="math inline">\(K_{human}\)</span> (<code>K_human</code>), the maximum probability of transmission.</li>
<li>
<span class="math inline">\(M\gamma\)</span> (<code>Mg_human</code>), the time when 50% <span class="math inline">\(K_{human}\)</span> is reached during the ascending phase.</li>
<li>
<span class="math inline">\(B\gamma\)</span> (<code>Bg_human</code>), the slope of the ascending curve.</li>
<li>
<span class="math inline">\(M\delta\)</span> (<code>Md_human</code>), the time when 50% <span class="math inline">\(K_{human}\)</span> is reached during the descending phase.</li>
<li>
<span class="math inline">\(B\delta\)</span> (<code>Bd_human</code>), the slope of the descending curve.</li>
</ul>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Dynamics of viremia in vertebrate (see Fontaine et al. for justification)</span>

<span class="va">K_human_fct</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">rbeta</a></span><span class="op">(</span><span class="va">x</span>,<span class="fl">0.98</span>,<span class="fl">0.002</span><span class="op">)</span><span class="op">}</span>
  
<span class="va">Mg_human_fct</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">x</span>,<span class="fl">4.844</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">}</span>
<span class="va">Bg_human_fct</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">x</span>,<span class="fl">2.536</span>,<span class="fl">0.2</span><span class="op">)</span><span class="op">}</span>

<span class="va">Md_human_fct</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">x</span>,<span class="fl">8.392</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">}</span>
<span class="va">Bd_human_fct</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">x</span>,<span class="fl">4.038</span>,<span class="fl">0.2</span><span class="op">)</span><span class="op">}</span>

<span class="va">param.pTrans_human</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>K_human<span class="op">=</span><span class="va">K_human_fct</span>, Mg_human<span class="op">=</span><span class="va">Mg_human_fct</span>, Bg_human<span class="op">=</span><span class="va">Bg_human_fct</span>, Md_human<span class="op">=</span><span class="va">Md_human_fct</span>, Bd_human<span class="op">=</span><span class="va">Bd_human_fct</span><span class="op">)</span> </code></pre></div>
<p>The profile of <code>pTrans</code> over time since infection of 150 unique hosts will look like this (red is the mean value for each parameter): <img src="dengue_files/figure-html/pTrans3-1.png" width="700"></p>
</div>
</div>
<div id="host-b-mosquitoes" class="section level2">
<h2 class="hasAnchor">
<a href="#host-b-mosquitoes" class="anchor"></a>Host B: Mosquitoes</h2>
<div id="pexit-1" class="section level3">
<h3 class="hasAnchor">
<a href="#pexit-1" class="anchor"></a><code>pExit</code>
</h3>
<p>In Fontaine <em>et al.</em>, the daily survival probability of a mosquito is 0.85, so its <code>pExit</code> equals 1-0.85:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p_Exit_fct_mosquito</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span><span class="op">{</span><span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fl">0.15</span><span class="op">)</span><span class="op">}</span></code></pre></div>
</div>
<div id="pmove-1" class="section level3">
<h3 class="hasAnchor">
<a href="#pmove-1" class="anchor"></a><code>pMove</code>
</h3>
<p>We will assume here that mosquitoes do not move between discrete states:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p_Move_fct_mosquito</span>  <span class="op">&lt;-</span> <span class="cn">NA</span></code></pre></div>
</div>
<div id="ncontact-1" class="section level3">
<h3 class="hasAnchor">
<a href="#ncontact-1" class="anchor"></a><code>nContact</code>
</h3>
<p>In Fontaine <em>et al.</em>, the daily biting probability of a mosquito is 0.3. We assume that if a mosquito bites, it bites only one human:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nContact_fct_mosquito</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,<span class="fl">1</span>,prob<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.7</span>,<span class="fl">0.3</span><span class="op">)</span><span class="op">)</span><span class="op">}</span></code></pre></div>
</div>
<div id="ptrans-1" class="section level3">
<h3 class="hasAnchor">
<a href="#ptrans-1" class="anchor"></a><code>pTrans</code>
</h3>
<p>In Fontaine <em>et al.</em>, the probability of transmission from a mosquito to a human is approximated by the measure of dissemination, a proxy for the extrinsic incubation period (EIP). We will assume here that <code>pTrans</code> is defined in the form of a threshold function: before a certain amount of time since initial infection (EIP), the mosquito does not transmit (<code>t_EIP</code>), and after that time, it will transmit with a certain (constant) probability (which we will call <code>p_max</code>). This function will be dependent on the time since the mosquito’s infection <code>t</code>:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p_Trans_fct</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">p_max</span>, <span class="va">t_EIP</span><span class="op">)</span><span class="op">{</span>
    <span class="kw">if</span><span class="op">(</span><span class="va">t</span> <span class="op">&lt;</span> <span class="va">t_EIP</span><span class="op">)</span><span class="op">{</span><span class="va">p</span><span class="op">=</span><span class="fl">0</span><span class="op">}</span>
    <span class="kw">if</span><span class="op">(</span><span class="va">t</span> <span class="op">&gt;=</span> <span class="va">t_EIP</span><span class="op">)</span><span class="op">{</span><span class="va">p</span><span class="op">=</span><span class="va">p_max</span><span class="op">}</span>
    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Based on experimental data from a Thai viral isolate in a Thai mosquito population in Fontaine <em>et al.</em>, the distribution in the mosquito population for the EIP parameter is (you can see <a href="example/vector-competence.html">the vector competence example</a> for more details):</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t_EIP</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">rlogis</a></span><span class="op">(</span><span class="va">x</span>, location <span class="op">=</span> <span class="fl">5.15</span>, scale <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">1.24</span><span class="op">)</span><span class="op">}</span></code></pre></div>
</div>
</div>
</div>
<div id="running-nosoi" class="section level1">
<h1 class="hasAnchor">
<a href="#running-nosoi" class="anchor"></a>Running <code>nosoi</code>
</h1>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/slequime/nosoi">nosoi</a></span><span class="op">)</span></code></pre></div>
<pre><code>## Loading required package: data.table</code></pre>
<pre><code>## 
## Attaching package: 'data.table'</code></pre>
<pre><code>## The following objects are masked from 'package:dplyr':
## 
##     between, first, last</code></pre>
<pre><code>## The following object is masked from 'package:purrr':
## 
##     transpose</code></pre>
<pre><code>## The following object is masked from 'package:raster':
## 
##     shift</code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Transition matrix</span>
<span class="co"># transition.matrix</span>

<span class="co">#Host A: Humans -----------------------------------</span>

<span class="co">#pExit</span>
<span class="va">p_Exit_fct_human</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>,<span class="va">Md_human</span><span class="op">)</span><span class="op">{</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">t</span> <span class="op">&lt;</span> <span class="fl">3</span><span class="op">*</span><span class="va">Md_human</span><span class="op">)</span><span class="op">{</span><span class="va">p</span><span class="op">=</span><span class="fl">0</span><span class="op">}</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">t</span> <span class="op">&gt;=</span> <span class="fl">3</span><span class="op">*</span><span class="va">Md_human</span><span class="op">)</span><span class="op">{</span><span class="va">p</span><span class="op">=</span><span class="fl">1</span><span class="op">}</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span>
<span class="op">}</span>

<span class="co">#pMove</span>
<span class="va">p_Move_fct_human</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span><span class="op">{</span><span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fl">0.01</span><span class="op">)</span><span class="op">}</span>

<span class="co">#nContact</span>
<span class="va">n_contact_human</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">prestime</span>, <span class="va">current.in</span><span class="op">)</span> <span class="op">{</span>
<span class="co">#functions</span>
<span class="va">R.activity</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">temp</span><span class="op">)</span><span class="op">{</span><span class="fl">0.0011</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fl">0.0101</span><span class="op">*</span><span class="op">(</span><span class="va">temp</span><span class="op">-</span><span class="fl">40</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="va">temp</span><span class="op">-</span><span class="fl">10</span><span class="op">)</span><span class="op">*</span><span class="fl">3.445</span><span class="op">}</span>
<span class="va">fun1</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">k1</span>, <span class="va">k2</span>, <span class="va">Beta</span><span class="op">)</span><span class="op">{</span><span class="va">k1</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">/</span><span class="fl">365</span><span class="op">*</span><span class="va">x</span><span class="op">)</span><span class="op">+</span><span class="va">k2</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">/</span><span class="fl">365</span><span class="op">*</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="va">Beta</span><span class="op">}</span>
<span class="va">fun2</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">k1</span>, <span class="va">k2</span>, <span class="va">Beta</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">R.activity</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">temp</span><span class="op">)</span><span class="op">{</span><span class="fl">0.0011</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fl">0.0101</span><span class="op">*</span><span class="op">(</span><span class="va">temp</span><span class="op">-</span><span class="fl">40</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="va">temp</span><span class="op">-</span><span class="fl">10</span><span class="op">)</span><span class="op">*</span><span class="fl">3.445</span><span class="op">}</span>
  <span class="va">temp</span> <span class="op">=</span> <span class="fu">R.activity</span><span class="op">(</span><span class="fu">fun1</span><span class="op">(</span><span class="va">x</span>, <span class="va">k1</span>, <span class="va">k2</span>, <span class="va">Beta</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">0.008001941</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">temp</span> <span class="op">&lt;=</span> <span class="fl">0</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">temp</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span><span class="op">}</span>

<span class="co">#temp results depending of location</span>
<span class="kw">if</span> <span class="op">(</span><span class="va">current.in</span> <span class="op">==</span> <span class="st">"CHN"</span><span class="op">)</span> <span class="op">{</span><span class="va">mosquito.activity</span> <span class="op">=</span> <span class="fu">fun2</span><span class="op">(</span><span class="va">prestime</span>, <span class="op">-</span><span class="fl">2.7250361</span>, <span class="fl">8.2347735</span>, <span class="fl">15.35648</span><span class="op">)</span><span class="op">}</span>
<span class="kw">if</span> <span class="op">(</span><span class="va">current.in</span> <span class="op">==</span> <span class="st">"KHM"</span><span class="op">)</span> <span class="op">{</span><span class="va">mosquito.activity</span> <span class="op">=</span> <span class="fu">fun2</span><span class="op">(</span><span class="va">prestime</span>, <span class="fl">0.8137334</span>, <span class="op">-</span><span class="fl">1.4049071</span>, <span class="fl">26.79546</span><span class="op">)</span><span class="op">}</span>
<span class="kw">if</span> <span class="op">(</span><span class="va">current.in</span> <span class="op">==</span> <span class="st">"LAO"</span><span class="op">)</span> <span class="op">{</span><span class="va">mosquito.activity</span> <span class="op">=</span> <span class="fu">fun2</span><span class="op">(</span><span class="va">prestime</span>, <span class="op">-</span><span class="fl">0.2478662</span>, <span class="op">-</span><span class="fl">3.7164672</span>, <span class="fl">23.09855</span><span class="op">)</span><span class="op">}</span>
<span class="kw">if</span> <span class="op">(</span><span class="va">current.in</span> <span class="op">==</span> <span class="st">"THA"</span><span class="op">)</span> <span class="op">{</span><span class="va">mosquito.activity</span> <span class="op">=</span> <span class="fu">fun2</span><span class="op">(</span><span class="va">prestime</span>, <span class="fl">0.8709198</span>, <span class="op">-</span><span class="fl">2.064461</span>, <span class="fl">26.28191</span><span class="op">)</span><span class="op">}</span>
<span class="kw">if</span> <span class="op">(</span><span class="va">current.in</span> <span class="op">==</span> <span class="st">"VNM"</span><span class="op">)</span> <span class="op">{</span><span class="va">mosquito.activity</span> <span class="op">=</span> <span class="fu">fun2</span><span class="op">(</span><span class="va">prestime</span>, <span class="op">-</span><span class="fl">0.6151016</span>, <span class="op">-</span><span class="fl">3.7640298</span>, <span class="fl">23.49819</span><span class="op">)</span><span class="op">}</span>

<span class="co">#final result</span>
<span class="va">temp.contact2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">mosquito.activity</span><span class="op">*</span><span class="fl">2</span>,sd<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="kw">if</span><span class="op">(</span><span class="va">temp.contact2</span> <span class="op">&gt;=</span> <span class="fl">0</span><span class="op">)</span> <span class="va">final.contact</span> <span class="op">=</span> <span class="va">temp.contact2</span>
<span class="kw">if</span> <span class="op">(</span><span class="va">temp.contact2</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span> <span class="va">final.contact</span> <span class="op">=</span> <span class="fl">0</span>

<span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">final.contact</span><span class="op">)</span>
<span class="op">}</span>

<span class="co">#pTrans</span>
<span class="va">p_Trans_fct_human</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">K_human</span>, <span class="va">Mg_human</span>, <span class="va">Bg_human</span>, <span class="va">Md_human</span>, <span class="va">Bd_human</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">K_human</span><span class="op">*</span><span class="fl">1</span><span class="op">/</span><span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Hyperbolic.html">tanh</a></span><span class="op">(</span><span class="op">(</span><span class="va">t</span><span class="op">-</span><span class="va">Mg_human</span><span class="op">)</span><span class="op">/</span><span class="va">Bg_human</span><span class="op">)</span><span class="op">)</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Hyperbolic.html">tanh</a></span><span class="op">(</span><span class="op">(</span><span class="va">t</span><span class="op">-</span><span class="va">Md_human</span><span class="op">)</span><span class="op">/</span><span class="va">Bd_human</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">K_human_fct</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">rbeta</a></span><span class="op">(</span><span class="va">x</span>,<span class="fl">0.98</span>,<span class="fl">0.002</span><span class="op">)</span><span class="op">}</span>
  
<span class="va">Mg_human_fct</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">x</span>,<span class="fl">4.844</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">}</span>
<span class="va">Bg_human_fct</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">x</span>,<span class="fl">2.536</span>,<span class="fl">0.2</span><span class="op">)</span><span class="op">}</span>

<span class="va">Md_human_fct</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">x</span>,<span class="fl">8.392</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">}</span>
<span class="va">Bd_human_fct</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">x</span>,<span class="fl">4.038</span>,<span class="fl">0.2</span><span class="op">)</span><span class="op">}</span>

<span class="va">param.pTrans_human</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>K_human<span class="op">=</span><span class="va">K_human_fct</span>, Mg_human<span class="op">=</span><span class="va">Mg_human_fct</span>, Bg_human<span class="op">=</span><span class="va">Bg_human_fct</span>, Md_human<span class="op">=</span><span class="va">Md_human_fct</span>, Bd_human<span class="op">=</span><span class="va">Bd_human_fct</span><span class="op">)</span>

<span class="co">#Host B: Mosquitoes -----------------------------------</span>

<span class="co">#pExit</span>
<span class="va">p_Exit_fct_mosquito</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span><span class="op">{</span><span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fl">0.15</span><span class="op">)</span><span class="op">}</span>

<span class="co">#pMove</span>
<span class="va">p_Move_fct_mosquito</span>  <span class="op">&lt;-</span> <span class="cn">NA</span>

<span class="co">#nContact</span>
<span class="va">nContact_fct_mosquito</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,<span class="fl">1</span>,prob<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.7</span>,<span class="fl">0.3</span><span class="op">)</span><span class="op">)</span><span class="op">}</span>

<span class="co">#pTrans</span>
<span class="va">p_Trans_fct_mosquito</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">p_max</span>, <span class="va">t_EIP</span><span class="op">)</span><span class="op">{</span>
    <span class="kw">if</span><span class="op">(</span><span class="va">t</span> <span class="op">&lt;</span> <span class="va">t_EIP</span><span class="op">)</span><span class="op">{</span><span class="va">p</span><span class="op">=</span><span class="fl">0</span><span class="op">}</span>
    <span class="kw">if</span><span class="op">(</span><span class="va">t</span> <span class="op">&gt;=</span> <span class="va">t_EIP</span><span class="op">)</span><span class="op">{</span><span class="va">p</span><span class="op">=</span><span class="va">p_max</span><span class="op">}</span>
    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">p_max_fct</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span><span class="va">x</span>,<span class="fl">1</span>, <span class="fl">0.98</span><span class="op">)</span><span class="op">}</span>
<span class="va">t_EIP_fct</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">rlogis</a></span><span class="op">(</span><span class="va">x</span>, location <span class="op">=</span> <span class="fl">5.15</span>, scale <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">1.24</span><span class="op">)</span><span class="op">}</span>
<span class="va">param_pTrans_mosquito</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>p_max<span class="op">=</span><span class="va">p_max_fct</span>,t_EIP<span class="op">=</span><span class="va">t_EIP_fct</span><span class="op">)</span>

<span class="co"># Starting the simulation ------------------------------------</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">60</span><span class="op">)</span>
<span class="va">test.nosoiA</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/nosoiSim.html">nosoiSim</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"dual"</span>, popStructure<span class="op">=</span><span class="st">"discrete"</span>,
                        length.sim<span class="op">=</span><span class="fl">365</span>, 
                        max.infected.A<span class="op">=</span><span class="fl">5000</span>,
                        max.infected.B<span class="op">=</span><span class="fl">200000</span>,
                        init.individuals.A<span class="op">=</span><span class="fl">1</span>,
                        init.individuals.B<span class="op">=</span><span class="fl">0</span>,
                        init.structure.A<span class="op">=</span><span class="st">"VNM"</span>,
                        init.structure.B<span class="op">=</span><span class="cn">NA</span>,
                        structure.matrix.A<span class="op">=</span><span class="va">transition.matrix</span>,
                        structure.matrix.B<span class="op">=</span><span class="va">transition.matrix</span>,
                        
                        <span class="co">#Human</span>
                        pExit.A <span class="op">=</span> <span class="va">p_Exit_fct_human</span>,
                        param.pExit.A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Md_human<span class="op">=</span><span class="va">Md_human_fct</span><span class="op">)</span>,
                        timeDep.pExit.A<span class="op">=</span><span class="cn">FALSE</span>,
                        diff.pExit.A<span class="op">=</span><span class="cn">FALSE</span>,
                        
                        pMove.A <span class="op">=</span> <span class="va">p_Move_fct_human</span>,
                        param.pMove.A <span class="op">=</span> <span class="cn">NA</span>,
                        timeDep.pMove.A<span class="op">=</span><span class="cn">FALSE</span>,
                        diff.pMove.A<span class="op">=</span><span class="cn">FALSE</span>,
                        
                        nContact.A<span class="op">=</span><span class="va">n_contact_human</span>,
                        param.nContact.A<span class="op">=</span><span class="cn">NA</span>,
                        timeDep.nContact.A<span class="op">=</span><span class="cn">TRUE</span>,
                        diff.nContact.A<span class="op">=</span><span class="cn">TRUE</span>,

                        pTrans.A <span class="op">=</span> <span class="va">p_Trans_fct_human</span>,
                        param.pTrans.A <span class="op">=</span> <span class="va">param.pTrans_human</span>,
                        timeDep.pTrans.A<span class="op">=</span><span class="cn">FALSE</span>,
                        diff.pTrans.A<span class="op">=</span><span class="cn">FALSE</span>,
                        prefix.host.A<span class="op">=</span><span class="st">"H"</span>,
                        
                        <span class="co">#Mosquito</span>
                        pExit.B <span class="op">=</span> <span class="va">p_Exit_fct_mosquito</span>,
                        param.pExit.B <span class="op">=</span> <span class="cn">NA</span>,
                        timeDep.pExit.B<span class="op">=</span><span class="cn">FALSE</span>,
                        diff.pExit.B<span class="op">=</span><span class="cn">FALSE</span>,
                        
                        pMove.B <span class="op">=</span> <span class="va">p_Move_fct_mosquito</span>,
                        param.pMove.B <span class="op">=</span> <span class="cn">NA</span>,
                        timeDep.pMove.B<span class="op">=</span><span class="cn">FALSE</span>,
                        diff.pMove.B<span class="op">=</span><span class="cn">FALSE</span>,
                        
                        nContact.B<span class="op">=</span><span class="va">nContact_fct_mosquito</span>,
                        param.nContact.B<span class="op">=</span><span class="cn">NA</span>,
                        timeDep.nContact.B<span class="op">=</span><span class="cn">FALSE</span>,
                        diff.nContact.B<span class="op">=</span><span class="cn">FALSE</span>,

                        pTrans.B <span class="op">=</span> <span class="va">p_Trans_fct_mosquito</span>,
                        param.pTrans.B <span class="op">=</span> <span class="va">param_pTrans_mosquito</span>,
                        timeDep.pTrans.B<span class="op">=</span><span class="cn">FALSE</span>,
                        diff.pTrans.B<span class="op">=</span><span class="cn">FALSE</span>,
                        prefix.host.B<span class="op">=</span><span class="st">"M"</span>,
                        
                        print.progress<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code>## Starting the simulation
## Initializing ...</code></pre>
<pre><code>##  running ...</code></pre>
<pre><code>## done. 
## The simulation has run for 96 units of time and a total of 5253 (A) and 16699 (B) hosts have been infected.</code></pre>
<p>The simulation has run for 96 units of time and has infected 5253 humans and 1.6699^{4} mosquitoes. The simulation was stopped because it reached the infected human cap <code>max.infected.A</code>.</p>
</div>
<div id="analyzing-the-results" class="section level1">
<h1 class="hasAnchor">
<a href="#analyzing-the-results" class="anchor"></a>Analyzing the results</h1>
<div id="visualization" class="section level2">
<h2 class="hasAnchor">
<a href="#visualization" class="anchor"></a>Visualization</h2>
<p>Our first step will be to visualize this epidemic on the map. We can use the following code to produce an animation (in time) of the epidemic:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Packages needed:</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>; <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://gganimate.com">gganimate</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>

<span class="co">#melting the matrix go get from -&gt; to in one line with probability</span>
<span class="co"># melted.transition.matrix &lt;- reshape2::melt(transition.matrix, varnames = c("from","to"),value.name="prob", as.is = TRUE) </span>
<span class="va">melted.transition.matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">as.data.frame.table</a></span><span class="op">(</span><span class="va">transition.matrix</span>,
                                                stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">melted.transition.matrix</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"from"</span>, <span class="st">"to"</span>, <span class="st">"prob"</span><span class="op">)</span>
<span class="va">melted.transition.matrix</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/subset.html">subset</a></span><span class="op">(</span><span class="va">melted.transition.matrix</span>, <span class="va">prob</span><span class="op">!=</span><span class="fl">0</span><span class="op">)</span>

<span class="co">#Loading data from the simulation</span>
<span class="va">test.nosoiA.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/getTableState.html">getTableState</a></span><span class="op">(</span><span class="va">test.nosoiA</span><span class="op">)</span>

<span class="co">#Loop to get the number of infected in each state per unit of time</span>
<span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">test.nosoiA.data</span><span class="op">$</span><span class="va">time.from</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/subset.html">subset</a></span><span class="op">(</span><span class="va">test.nosoiA.data</span>, <span class="va">time.from</span> <span class="op">&lt;=</span> <span class="va">i</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">time.to</span> <span class="op">&gt;</span> <span class="va">i</span> <span class="op">|</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">time.to</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"hosts.ID"</span>,<span class="st">"state"</span><span class="op">)</span><span class="op">]</span>
  <span class="va">temp</span><span class="op">$</span><span class="va">time</span> <span class="op">&lt;-</span> <span class="va">i</span>
  <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html">rbindlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">test2</span> <span class="op">&lt;-</span> <span class="va">results</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">state</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>N<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">hosts.ID</span><span class="op">)</span><span class="op">)</span>

<span class="co">#Loop to get the transitions between states and their time</span>
<span class="va">results2</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/unique.html">unique</a></span><span class="op">(</span><span class="va">test.nosoiA.data</span><span class="op">$</span><span class="va">hosts.ID</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">subset.current</span> <span class="op">&lt;-</span> <span class="va">test.nosoiA.data</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html">nrow</a></span><span class="op">(</span><span class="va">subset.current</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span><span class="op">{</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html">nrow</a></span><span class="op">(</span><span class="va">subset.current</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="op">(</span>hosts.ID<span class="op">=</span><span class="va">i</span>,time<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">subset.current</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">$</span><span class="va">time.to</span><span class="op">)</span>,from<span class="op">=</span><span class="va">subset.current</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">$</span><span class="va">state</span>,to<span class="op">=</span><span class="va">subset.current</span><span class="op">[</span><span class="va">j</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span><span class="op">$</span><span class="va">state</span><span class="op">)</span>
   <span class="va">results2</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html">rbindlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">results2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
    <span class="op">}</span><span class="op">}</span><span class="op">}</span>

<span class="va">test3</span> <span class="op">&lt;-</span> <span class="va">results2</span> <span class="op">%&gt;%</span> <span class="fu">group_by</span><span class="op">(</span><span class="va">time</span>,<span class="va">from</span>,<span class="va">to</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>N<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">hosts.ID</span><span class="op">)</span><span class="op">)</span>

<span class="co">#adding the coordinates of each country</span>
<span class="va">test2.bis</span> <span class="op">=</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">test2</span>,<span class="va">countries.point</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"state"</span><span class="op">=</span><span class="st">"country"</span><span class="op">)</span><span class="op">)</span>
<span class="va">test3.bis</span> <span class="op">=</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">test3</span>,<span class="va">countries.point</span>,by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"from"</span> <span class="op">=</span> <span class="st">"country"</span><span class="op">)</span><span class="op">)</span>
<span class="va">test3.bis</span> <span class="op">=</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">test3.bis</span>,<span class="va">countries.point</span>,by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"to"</span> <span class="op">=</span> <span class="st">"country"</span><span class="op">)</span>, suffix<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"from"</span>,<span class="st">"to"</span><span class="op">)</span><span class="op">)</span>

<span class="co">#Worldmap background</span>
<span class="va">worldmap</span> <span class="op">&lt;-</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/borders.html">borders</a></span><span class="op">(</span><span class="st">"world"</span>, colour<span class="op">=</span><span class="st">"gray50"</span>, fill<span class="op">=</span><span class="st">"#efede1"</span>,t<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">182</span><span class="op">)</span>

<span class="co">#Animated plot (using gganimate):</span>
<span class="va">animated.plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="va">worldmap</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">90</span>, <span class="fl">125</span><span class="op">)</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">30</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">test2.bis</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">long</span>,<span class="va">lat</span>, color<span class="op">=</span><span class="va">state</span>,size<span class="op">=</span><span class="va">N</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_curve</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">test3.bis</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">longfrom</span>,y<span class="op">=</span><span class="va">latfrom</span>,xend<span class="op">=</span><span class="va">longto</span>,yend<span class="op">=</span><span class="va">latto</span><span class="op">)</span>,arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.03</span>, <span class="st">"npc"</span><span class="op">)</span>,type <span class="op">=</span> <span class="st">"closed"</span><span class="op">)</span>,curvature <span class="op">=</span> <span class="fl">0.2</span>,color<span class="op">=</span><span class="st">"gray50"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_hue.html">scale_color_discrete</a></span><span class="op">(</span>guide<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> 
<span class="fu"><a href="https://gganimate.com/reference/transition_states.html">transition_states</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html">scale_size_continuous</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"Number of \n infected humans"</span>, trans<span class="op">=</span><span class="st">"log10"</span>, range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">15</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Time: {closest_state}"</span><span class="op">)</span>

<span class="fu"><a href="https://gganimate.com/reference/animate.html">animate</a></span><span class="op">(</span><span class="va">animated.plot</span>, nframes<span class="op">=</span><span class="va">test.nosoiA</span><span class="op">$</span><span class="va">total.time</span><span class="op">*</span><span class="fl">2</span><span class="op">+</span><span class="fl">10</span>,duration<span class="op">=</span><span class="fl">40</span>,end_pause<span class="op">=</span><span class="fl">10</span><span class="op">)</span></code></pre></div>
<p><img src="dengue_files/figure-html/visualisationMatrix-1.gif"><!-- --></p>
</div>
<div id="epidemiological-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#epidemiological-analysis" class="anchor"></a>Epidemiological analysis</h2>
<p>As interesting as the visualization might be, we can also explore the epidemic parameters, for example the “real” <span class="math inline">\(R_0\)</span>, defined as the average number of cases one case generates, often estimated in epidemiological studies. To this end, we can use the following code:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">R0.sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/getR0.html">getR0</a></span><span class="op">(</span><span class="va">test.nosoiA</span><span class="op">)</span></code></pre></div>
<p>The mean value for <span class="math inline">\(R_0\)</span> is 6.64, which is coherent with <span class="math inline">\(R_0\)</span> estimates for dengue (see for example <a href="https://apps.who.int/iris/handle/10665/170261">Nishiura 2006 <em>Dengue Bulletin</em></a>). Its distribution shows that most of the human hosts are responsible for the infection of a least one other human host:</p>
<p><img src="dengue_files/figure-html/generalEpi2-1.png" width="700"></p>
<p>On the mosquito side, the mean value for <span class="math inline">\(R_0\)</span> is 0.31 and the distribution shows that most of the mosquitoes, except for a few, are actually dead-end hosts: <img src="dengue_files/figure-html/generalEpi3-1.png" width="700"></p>
<p>The two following figures also provide the epidemiological dynamics of the simulation:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="va">cumulative.table</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/getCumulative.html">getCumulative</a></span><span class="op">(</span><span class="va">test.nosoiA</span><span class="op">)</span>
<span class="va">dynamics.table</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/getDynamic.html">getDynamic</a></span><span class="op">(</span><span class="va">test.nosoiA</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">cumulative.table</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">t</span>, y<span class="op">=</span><span class="va">Count</span>,linetype<span class="op">=</span><span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"Time (t)"</span>,y<span class="op">=</span><span class="st">"Cumulative count of infected hosts"</span><span class="op">)</span></code></pre></div>
<p><img src="dengue_files/figure-html/figureDynamics1-1.png" width="700"></p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">dynamics.table</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">t</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">Count</span><span class="op">)</span>, color<span class="op">=</span><span class="va">state</span>,linetype<span class="op">=</span><span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"Time (t)"</span>,y<span class="op">=</span><span class="st">"Number of active infected hosts\n(log10 scale)"</span><span class="op">)</span></code></pre></div>
<p><img src="dengue_files/figure-html/figureDynamics2-1.png" width="700"></p>
</div>
<div id="transmission-chain" class="section level2">
<h2 class="hasAnchor">
<a href="#transmission-chain" class="anchor"></a>Transmission chain</h2>
<p>The central transmission chain simulated by <code>nosoi</code> can also be visualized. To achieve this, we generate the transmission tree as a phylogenetic tree-like object by using the <code>getTransmissionTree</code> function implemented in <code>nosoi</code>:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">test.nosoiA.tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/getTransmissionTree.html">getTransmissionTree</a></span><span class="op">(</span><span class="va">test.nosoiA</span><span class="op">)</span></code></pre></div>
<p>This function gives you a <code>treedata</code> object that can be visualized as a phylogenetic tree with the package :</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yulab-smu.top/treedata-book/">ggtree</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree</a></span><span class="op">(</span><span class="va">test.nosoiA.tree</span>, color <span class="op">=</span> <span class="st">"gray30"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_tippoint.html">geom_tippoint</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"gray30"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># geom_tiplab(aes(label=host)) + </span>
    <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/theme_tree2.html">theme_tree2</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Time (t)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.8</span><span class="op">)</span>, 
        legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
        legend.key <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="dengue_files/figure-html/treeC-1.png" width="700"></p>
<p>This tree is a bit messy, which was to be expected considering the number of transmission events and the overall size of this epidemic. We can also subsample it randomly. We will here select 150 individuals sampled at the time of their exit (either death or recovery):</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Extracts data from the nosoiSim object:</span>
<span class="va">test.table.hosts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/getTableHosts.html">getTableHosts</a></span><span class="op">(</span><span class="va">test.nosoiA</span>, pop<span class="op">=</span><span class="st">"A"</span><span class="op">)</span>
<span class="co"># test.nosoiA.tree &lt;- getTransmissionTree(test.nosoiA)</span>

<span class="co">#Sampling the names of individuals to be sampled:</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">5905950</span><span class="op">)</span>
<span class="va">sampled.hosts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/subset.html">subset</a></span><span class="op">(</span><span class="va">test.table.hosts</span>, <span class="va">active</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">$</span><span class="va">hosts.ID</span>, <span class="fl">150</span><span class="op">)</span>

<span class="co">#Subsampling:</span>
<span class="va">test.nosoiA.tree.sampled.exiting</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/sampleTransmissionTreeFromExiting.html">sampleTransmissionTreeFromExiting</a></span><span class="op">(</span><span class="va">test.nosoiA.tree</span>, <span class="va">sampled.hosts</span><span class="op">)</span></code></pre></div>
<p>This new tree can be also plotted as before, with colors representing the state (i.e. country) of each tip and node:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yulab-smu.top/treedata-book/">ggtree</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree</a></span><span class="op">(</span><span class="va">test.nosoiA.tree.sampled.exiting</span>, color <span class="op">=</span> <span class="st">"gray30"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_nodepoint.html">geom_nodepoint</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color<span class="op">=</span><span class="va">state</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_tippoint.html">geom_tippoint</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color<span class="op">=</span><span class="va">state</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="co"># geom_tiplab(aes(label=host)) + </span>
    <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/theme_tree2.html">theme_tree2</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Time (t)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>,<span class="fl">0.8</span><span class="op">)</span>, 
        legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
        legend.key <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="dengue_files/figure-html/treeC2-1.png" width="700"></p>
</div>
<div id="other-use" class="section level2">
<h2 class="hasAnchor">
<a href="#other-use" class="anchor"></a>Other use</h2>
<p>External software can be used to perform a more detailed exploration of the dynamics of this epidemic and transmission chain. The <code>write.beast</code> function of the <code>treeio</code> package allows for an easy export of the transmission chain as a phylogenetic-like tree, in a similar format as <a href="https://beast.community/">BEAST</a> trees.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">treeio</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/treeio/reference/write.beast.html">write.beast</a></span><span class="op">(</span><span class="va">test.nosoiA.tree</span>, file <span class="op">=</span> <span class="st">"test.tre"</span>, translate <span class="op">=</span> <span class="cn">TRUE</span>, tree.name <span class="op">=</span> <span class="st">"UNTITLED"</span><span class="op">)</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Sebastian Lequime, Paul Bastide, Simon Dellicour, Philippe Lemey, Guy Baele.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
